<Window x:Class="EmailToastUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Email Notification Dashboard" Height="600" Width="850"
        WindowStartupLocation="CenterScreen" Background="#0C0D0F"
        WindowStyle="None" AllowsTransparency="True" MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <SolidColorBrush x:Key="AccentColor" Color="#4A80F6"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#15161A"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#2A2A2A"/>
        
        <Style x:Key="NavButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#8A8A93"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="NavBorder" Background="{TemplateBinding Background}" CornerRadius="6" Margin="10,2">
                            <ContentPresenter Margin="{TemplateBinding Padding}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="NavBorder" Property="Background" Value="#1F2025"/>
                                <Setter Property="Foreground" Value="#E0E0E0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ProviderCardButton" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="#1C1E23" CornerRadius="12" BorderThickness="1" BorderBrush="{StaticResource BorderBrush}" Margin="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="20"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.6"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98" CenterX="100" CenterY="50"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
        </Style>
        
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="15,8"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#25262B"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" BorderThickness="1" BorderBrush="#35363B">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="15,8"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#303136"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#15161A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="0"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border BorderThickness="1" BorderBrush="#222" CornerRadius="12" Background="#0C0D0F">
        <Grid>
            <!-- Title Bar -->
            <Grid Height="40" VerticalAlignment="Top" Panel.ZIndex="10">
                <TextBlock Text="Email Notification Dashboard" Foreground="#777" FontSize="12" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False"/>
                <Button HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,15,0" Width="14" Height="14" Click="CloseApp_Click" Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Button.Template>
                        <ControlTemplate>
                            <Ellipse Fill="#FF5F56"/>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <Grid Margin="0,40,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Navigation Panel -->
                <Border Grid.Column="0" Background="{StaticResource PanelBrush}" BorderThickness="0,1,1,0" BorderBrush="#1F2025" CornerRadius="0,0,0,12">
                    <StackPanel Margin="0,20,0,0">
                        <TextBlock Text="MAIN MENU" Foreground="#555" FontSize="11" FontWeight="Bold" Margin="25,0,0,10"/>
                        
                        <Button x:Name="NavAccounts" Content="Connect Accounts" Style="{StaticResource NavButton}" Click="NavAccounts_Click" Foreground="{StaticResource AccentColor}">
                            <Button.Background>
                                <SolidColorBrush Color="#1A2A4C"/>
                            </Button.Background>
                        </Button>
                        <Button x:Name="NavDashboard" Content="Dashboard" Style="{StaticResource NavButton}" Click="NavDashboard_Click"/>
                        <Button x:Name="NavSettings" Content="Settings" Style="{StaticResource NavButton}" Click="NavSettings_Click"/>
                    </StackPanel>
                </Border>

                <!-- Right Content Area -->
                <Grid Grid.Column="1" Margin="30,20,30,30">
                    
                    <!-- View: Add Accounts -->
                    <Grid x:Name="ViewAccounts" Visibility="Visible">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Connect Email Accounts" Foreground="White" FontSize="26" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Grid.Row="1" Text="Select providers to login and authorize notifications." Foreground="#888" FontSize="14" Margin="0,0,0,30"/>
                        
                        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                            <WrapPanel x:Name="ProviderPanel">
                                <!-- Gmail -->
                                <Button Style="{StaticResource ProviderCardButton}" Width="250" Height="140" Click="LoginProvider_Click" Tag="Gmail">
                                    <StackPanel HorizontalAlignment="Center">
                                        <Border Width="48" Height="48" CornerRadius="12" Background="#EA4335" Margin="0,0,0,10">
                                            <TextBlock Text="G" Foreground="White" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <TextBlock Text="Login to Gmail" Foreground="White" FontSize="15" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <!-- Outlook -->
                                <Button Style="{StaticResource ProviderCardButton}" Width="250" Height="140" Click="LoginProvider_Click" Tag="Outlook">
                                    <StackPanel HorizontalAlignment="Center">
                                        <Border Width="48" Height="48" CornerRadius="12" Background="#0078D4" Margin="0,0,0,10">
                                            <TextBlock Text="O" Foreground="White" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <TextBlock Text="Login to Outlook" Foreground="White" FontSize="15" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </WrapPanel>
                        </ScrollViewer>
                    </Grid>

                    <!-- View: Dashboard / Inbox -->
                    <Grid x:Name="ViewDashboard" Visibility="Collapsed">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Recent Notifications" Foreground="White" FontSize="26" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Grid.Row="1" Text="View all incoming emails. Warning keywords are highlighted in red." Foreground="#888" FontSize="14" Margin="0,0,0,25"/>

                        <Grid Grid.Row="2">
                             <Grid.RowDefinitions>
                                 <RowDefinition Height="Auto"/>
                                 <RowDefinition Height="*"/>
                             </Grid.RowDefinitions>
                             
                             <!-- Filters (ItemsControl bound to ConnectedAccounts + "All") -->
                             <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Margin="0,0,0,15">
                                 <ItemsControl x:Name="FilterPanel">
                                     <ItemsControl.ItemsPanel>
                                         <ItemsPanelTemplate>
                                             <StackPanel Orientation="Horizontal"/>
                                         </ItemsPanelTemplate>
                                     </ItemsControl.ItemsPanel>
                                     <ItemsControl.ItemTemplate>
                                         <DataTemplate>
                                             <Button Content="{Binding Name}" Margin="0,0,10,0" Padding="15,8" Foreground="White" Background="{Binding BackgroundBrush}" FontWeight="SemiBold" BorderThickness="0" Cursor="Hand" Click="FilterButton_Click" Tag="{Binding Name}">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="15">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                             </Button>
                                         </DataTemplate>
                                     </ItemsControl.ItemTemplate>
                                 </ItemsControl>
                             </ScrollViewer>
                             
                             <!-- Emails List -->
                             <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                 <Grid>
                                    <TextBlock x:Name="NoEmailsText" Text="No accounts connected or no recent emails found." Foreground="#555" FontSize="14" HorizontalAlignment="Center" Margin="0,40,0,0" Visibility="Collapsed"/>
                                    <ItemsControl x:Name="EmailsList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border CornerRadius="8" Padding="15" Margin="0,0,0,10" BorderThickness="1" Visibility="{Binding Visibility}">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#1A1C20"/>
                                                            <Setter Property="BorderBrush" Value="#2C3038"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsWarning}" Value="True">
                                                                    <Setter Property="Background" Value="#2A1417"/>
                                                                    <Setter Property="BorderBrush" Value="#8B2A2A"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Border Width="40" Height="40" CornerRadius="8" Background="{Binding ProviderBrush}" VerticalAlignment="Top" Margin="0,0,15,0">
                                                            <TextBlock Text="{Binding IconLetter}" Foreground="White" FontWeight="Bold" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                        <Grid Grid.Column="1">
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>
                                                            <DockPanel Grid.Row="0">
                                                                <TextBlock Text="{Binding Sender}" Foreground="White" FontWeight="SemiBold" FontSize="14"/>
                                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                                                                    <Border Background="#7A1F28" CornerRadius="4" Padding="6,2" Margin="0,0,8,0" Visibility="{Binding WarningVisibility}">
                                                                        <TextBlock Text="Warning" Foreground="#FFD7D7" FontSize="10" FontWeight="Bold"/>
                                                                    </Border>
                                                                    <TextBlock Text="{Binding Time}" Foreground="#666" FontSize="12" HorizontalAlignment="Right"/>
                                                                </StackPanel>
                                                            </DockPanel>
                                                            <TextBlock Grid.Row="1" Text="{Binding Subject}" Foreground="#CCC" FontSize="13" Margin="0,4,0,4"/>
                                                            <TextBlock Grid.Row="2" Text="{Binding Preview}" Foreground="#888" FontSize="12" TextWrapping="Wrap"/>
                                                        </Grid>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                 </Grid>
                             </ScrollViewer>
                        </Grid>
                    </Grid>

                    <!-- View: Settings / Keywords -->
                    <Grid x:Name="ViewSettings" Visibility="Collapsed">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Application Settings" Foreground="White" FontSize="26" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Grid.Row="1" Text="Configure app behavior, security, and notification triggers." Foreground="#888" FontSize="14" Margin="0,0,0,25"/>

                        <StackPanel Grid.Row="2">
                            <!-- Keywords Configuration -->
                            <Border Background="{StaticResource PanelBrush}" CornerRadius="10" Padding="20" Margin="0,0,0,15">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Text="Warning Keywords" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                                    
                                    <Grid Grid.Row="1" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="txtKeyword" Grid.Column="0" Margin="0,0,10,0" VerticalContentAlignment="Center" KeyDown="txtKeyword_KeyDown" FontSize="13" Text="Invoice"/>
                                        <Button Grid.Column="1" Content="Add" Style="{StaticResource SecondaryButton}" Click="AddKeyword_Click"/>
                                    </Grid>

                                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Disabled" HorizontalScrollBarVisibility="Auto" Margin="0,0,0,15">
                                        <ItemsControl x:Name="KeywordsList">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="#25262B" CornerRadius="6" Padding="10,6" Margin="0,0,8,0">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Text="{Binding}" Foreground="#DDD" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                            <Button Grid.Column="1" Content="✕" FontFamily="Segoe UI" Foreground="#888" Background="Transparent" BorderThickness="0" VerticalAlignment="Center" Tag="{Binding}" Click="RemoveKeyword_Click" Cursor="Hand"/>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>

                                    <Button Grid.Row="3" Content="Check Inbox Now" Style="{StaticResource PrimaryButton}" Margin="0,5,0,0" Click="SimulateCheck_Click"/>
                                </Grid>
                            </Border>

                            <Border Background="{StaticResource PanelBrush}" CornerRadius="10" Padding="20">
                                <StackPanel>
                                    <TextBlock Text="Connection Notes" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                                    <TextBlock Text="Gmail and Outlook use OAuth sign-in in this app. No email password is required." Foreground="#DDD" TextWrapping="Wrap" Margin="0,0,0,10"/>
                                    <TextBlock Text="Monitoring runs continuously in the background and checks for keyword matches." Foreground="#DDD" TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>

                    <!-- Notification Modal overlay for adding accounts -->
                    <Grid x:Name="ModalOverlay" Visibility="Collapsed" Background="#C0000000">
                        <Border Background="#1A1C20" CornerRadius="12" Width="300" Height="150" HorizontalAlignment="Center" VerticalAlignment="Center" BorderThickness="1" BorderBrush="#333" Padding="20">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock x:Name="ModalText" Text="Logging into Provider..." Foreground="White" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                                <ProgressBar IsIndeterminate="True" Height="4" Width="200" Foreground="{StaticResource AccentColor}" Background="#111" BorderThickness="0"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                    
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
